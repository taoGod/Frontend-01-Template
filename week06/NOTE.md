# 每周总结可以写在这里

## 解析 HTML

HTML 有专门的词语定义，并用状态机实现。

状态机的初始状态，我们仅仅区分 “< ”和 “非 <”：
* 如果获得的是一个非 < 字符，那么可以认为进入了一个文本节点；
* 如果获得的是一个 < 字符，那么进入一个标签状态。
* 比如下一个字符是“ ! ” ，那么很可能是进入了注释节点或者 CDATA 节点。
* 如果下一个字符是 “/ ”，那么可以确定进入了一个结束标签。
* 如果下一个字符是字母，那么可以确定进入了一个开始标签。
* 如果我们要完整处理各种 HTML 标准中定义的东西，那么还要考虑“ ? ”“% ”等内容。

## 构建 DOM 树

通过这个栈，我们可以构建 DOM 树：
* 栈顶元素就是当前节点；
* 遇到属性，就添加到当前节点；
* 遇到文本节点，如果当前节点是文本节点，则跟文本节点合并，否则入栈成为当前节点的子节点；
* 遇到注释节点，作为当前节点的子节点；
* 遇到 tag start 就入栈一个节点，当前节点就是这个节点的父节点；
* 遇到 tag end 就出栈一个节点（还可以检查是否匹配）。

## 解析 CSS

* 遇到 style 标签时， 保存 CSS 规则
* 使用 css parser 分析 CSS 规则
* 匹配 DOM 元素：
  * 获取父元素队列
  * 拆分选择器，循环匹配元素及其父元素队列
* 匹配，则应用选择器到元素上，形成computedStyle
* 确定规则覆盖关系（specificity和后来优先规则覆盖）

